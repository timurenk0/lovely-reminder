import TelegramBot from "node-telegram-bot-api";
import { Redis } from "@upstash/redis";

const TELEGRAM_TOKEN = process.env.TELEGRAM_TOKEN;
const TELEGRAM_ID = process.env.TELEGRAM_ID;

const messages = [
    "üíå –ê–ø–¥–µ–π—Ç –ª—é–±–≤–∏ v1.0.1 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: —É–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å—á–∞—Å—Ç—å—è, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ü–µ–ª—É–µ–≤, –¥–æ–±–∞–≤–ª–µ–Ω –º–æ–¥—É–ª—å ¬´—Ç—ã ‚Äî –º–æ—ë –≤—Å—ë¬ª",

    "üåπ –ö–∞–∂–¥—ã–π –¥–µ–Ω—å —Å —Ç–æ–±–æ–π ‚Äî –∫–∞–∫ –Ω–æ–≤—ã–π –ª–∏—Å—Ç –≤ –∫–Ω–∏–≥–µ –Ω–∞—à–µ–π –ª—é–±–≤–∏",

    "üçï –ï—Å–ª–∏ –±—ã —Ç—ã –±—ã–ª–∞ –ø–∏—Ü—Ü–µ–π, —Ç–æ —Å –º–æ–∏–º–∏ –ª—é–±–∏–º—ã–º–∏ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏‚Ä¶ –∏ —è –±—ã –Ω–∏–∫–æ–≥–¥–∞ —Ç–µ–±—è –Ω–µ –¥–µ–ª–∏–ª!",

    "‚ú® –ö–æ–≥–¥–∞ —Ç—ã —Ä—è–¥–æ–º, –≤—Å—ë –≤–æ–∫—Ä—É–≥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏ —Ç—ë–ø–ª—ã–º",

    "üê• –¢—ã ‚Äî –º–æ—ë —É—Ç—Ä–æ, –º–æ—ë —Å–æ–ª–Ω—Ü–µ –∏ –º–æ–π –ø–æ–≤–æ–¥ –≤—Å—Ç–∞–≤–∞—Ç—å —Å —É–ª—ã–±–∫–æ–π",

    "üç´ –û–±–æ–∂–∞—é —Ç–µ–±—è —Ç–∞–∫ –∂–µ —Å–∏–ª—å–Ω–æ, –∫–∞–∫ —à–æ–∫–æ–ª–∞–¥‚Ä¶ –∞ —ç—Ç–æ –º–Ω–æ–≥–æ!",

    "üåå –ï—Å–ª–∏ –±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –∑–∞–≥–∞–¥–∞—Ç—å –æ–¥–Ω–æ –∂–µ–ª–∞–Ω–∏–µ, —è –±—ã –∑–∞–≥–∞–¥–∞–ª —Ç–µ–±—è‚Ä¶ –∏ –µ—â—ë –≤–µ—á–Ω–æ—Å—Ç—å –≤–º–µ—Å—Ç–µ",

    "üêæ –î–∞–∂–µ –µ—Å–ª–∏ —è –±—É–¥—É –≤ —Å–∞–º–æ–º –º—Ä–∞—á–Ω–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏, —Ç–≤–æ–π —Å–º–µ—Ö –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç –¥–æ—Ä–æ–≥—É –∫–æ –º–Ω–µ",

    "ü¶ä –¢—ã —Ö–∏—Ç—Ä–æ —É–º–µ–µ—à—å —É–∫—Ä–∞—Å—Ç—å –º–æ—ë —Å–µ—Ä–¥—Ü–µ, –∏ —è —Ä–∞–¥, —á—Ç–æ —Ç—ã –µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—à—å",

    "üïä –° —Ç–æ–±–æ–π —è –Ω–∞—É—á–∏–ª—Å—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –±—ã—Ç—å —Å—á–∞—Å—Ç–ª–∏–≤—ã–º –±–µ–∑ –ø–æ–≤–æ–¥–∞",

    "üé† –¢—ã –ø—Ä–µ–≤—Ä–∞—â–∞–µ—à—å –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å –≤ —è—Ä–º–∞—Ä–∫—É —Ä–∞–¥–æ—Å—Ç–∏ –∏ –Ω–µ–∂–Ω–æ—Å—Ç–∏",

    "üíû –õ—é–±–ª—é —Ç–µ–±—è —Ç–∞–∫, —á—Ç–æ –¥–∞–∂–µ —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π —Å–ª–æ–≤–∞—Ä—å –º–∏—Ä–∞ –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º (—Å–ø–∏—Å–æ–∫ –º–∏–ª—ã—Ö —Ñ—Ä–∞–∑–æ—á–µ–∫ —Å–∫–æ—Ä–æ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è, —Ç–∞–∫ —á—Ç–æ –Ω–∞–ø–æ–º–Ω–∏ —Å–≤–æ–µ–º—É –º—É—á–∞—á–æ –µ–≥–æ –æ–±–Ω–æ–≤–∏—Ç—å ;)",
]


const bot = new TelegramBot(TELEGRAM_TOKEN);
const redis = new Redis({
    url: process.env.UPSTASH_REDIS_REST_URL,
    token: process.env.UPSTASH_REDIS_REST_TOKEN,
})

export default async function handler(req, res) {
    let index = await redis.get("messageIndex") || 1;
    index = Number(index);
    
    const message = messages[index];
    try {
        await bot.sendMessage(TELEGRAM_ID, message);
        await redis.set("messageIndex", (index+1) & messages.length);
        res.status(200).json({ message: "Message sent successfully" });
    } catch (error) {
        res.status(500).json({ error: `Error sending message: ${error}` })
    }
}